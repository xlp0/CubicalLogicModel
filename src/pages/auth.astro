---
import Layout from '../layouts/Layout.astro';
import FloatingNav from '../components/FloatingNav';
import AuthCallback from '../components/AuthCallback';

// Check if user is already authenticated by looking for cookies
const userCookie = Astro.cookies.get('user')?.value;
const authToken = Astro.cookies.get('auth_token')?.value;

// Get error from query params
const error = Astro.url.searchParams.get('error');
const errorDescription = Astro.url.searchParams.get('error_description');

// If there's an error, redirect to home with error message
if (error) {
  return Astro.redirect(`/?error=${error}: ${errorDescription || 'Unknown error'}`);
}

// If user is already authenticated, redirect to home page
if (userCookie && authToken) {
  return Astro.redirect('/');
}
---

<Layout title="Authentication - Cubical Logic Model">
  <main class="flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-gray-900 to-gray-800 text-white p-4">
    <div class="w-full max-w-md">
      <h1 class="text-2xl font-bold text-center mb-8">
        Completing Authentication...
      </h1>
      <AuthCallback client:only="react" />
    </div>
    <FloatingNav client:load />
  </main>
</Layout>